name: Flutter CI

on:
  push:
    branches: [ "master" ]
  pull_request:
    branches: [ "master" ]

jobs:
  build:
    runs-on: ubuntu-latest

    steps:
      # 1Ô∏è‚É£ Checkout do reposit√≥rio
      - name: Checkout repository
        uses: actions/checkout@v4

      # 2Ô∏è‚É£ Instala Flutter (canal est√°vel)
      - name: Setup Flutter
        uses: subosito/flutter-action@v2
        with:
          flutter-version: 'stable'
          cache: true

      # 3Ô∏è‚É£ Diagn√≥stico do ambiente
      - name: Flutter doctor
        run: flutter doctor -v

      # 4Ô∏è‚É£ Instala depend√™ncias
      - name: Get dependencies
        run: flutter pub get

      # 5Ô∏è‚É£ Analisa o c√≥digo (lint e type check)
      - name: Analyze project source
        run: flutter analyze

      # 6Ô∏è‚É£ Verifica formata√ß√£o (opcional)
      - name: Verify formatting
        run: flutter format --set-exit-if-changed .

      # 7Ô∏è‚É£ Roda testes unit√°rios com cobertura
      - name: Run tests with coverage
        run: flutter test --coverage

      # 8Ô∏è‚É£ Gera APK de release
      - name: Build release APK
        run: flutter build apk --release

      # 9Ô∏è‚É£ Analisa tamanho do APK
      - name: Analyze APK size
        run: |
          flutter build apk --analyze-size
          echo "APK size analysis completed."

      # üîü Faz upload do APK como artefato do GitHub (pode ser baixado na aba 'Actions')
      - name: Upload release APK
        uses: actions/upload-artifact@v4
        with:
          name: app-release-apk
          path: build/app/outputs/flutter-apk/app-release.apk

      # (Opcional) Upload do relat√≥rio de cobertura tamb√©m
      - name: Upload coverage report
        uses: actions/upload-artifact@v4
        with:
          name: coverage-report
          path: coverage/lcov.info
